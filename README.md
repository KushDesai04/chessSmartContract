# Chess

## Architectuer
- `contract/` contains the smart contract code
- `uploader/` contains scripts to upload the contract and test it
- `frontend/` contains a React app for interacting with the auction contract


## Setup
 - Create `uploader/.env` and add your wallet mnemonic: `MNEMONIC="<mnemonic sentence>"`
 - `chmod +x build_and_upload.sh`
 - `./build_and_upload.sh`
 - Copy the contract hash and contract address generated by the above command into `frontend/.env`
 - Navigate to the address Vite gives you. Default is http://localhost:5173/
- The above command will upload and instantiate a contract, then run a local frontend instance automatically. These steps can also be performed individually:

#### Compiling The Contract:
   - `cd contract`
   - `make mainnet-build-reproducible`

#### Uploading The Compiled Contract:
   - `cd uploader`
   - `npm run build`
   - `npm run upload`
   - `npm run instantiate <contract_id> <contract_hash>` OR `npm run instantiate_and_test_chess <contract_id> <contract_hash>`
   - If wanting to instantiate and test the contact, the second command can be used.

#### Running the Frontend
   - `cd frontend`
   - `npm install`
   - `npm run dev`

 **Example `frontend/.env`** \
VITE_SECRET_CHAIN_ID=pulsar-3
VITE_SECRET_LCD=https://pulsar.lcd.secretnodes.com
VITE_CONTRACT_CODE_HASH=... \
VITE_CONTRACT_ADDR=secret1...

## Roles

### Player
 #### In Game
 - White - plays as the white pieces
 - Black - plays as the black pieces

You can only move the pieces that match your player colour (i.e. as white, you cannot move the black pieces). This is checked via stored wallet address.

 - Creator - creates and game, setting the wager amount
 - Opponent - joins the game, matches the wager amount

The players compete in a chess game for the prize pot (wager from both sides).

### Spectator
Can join any game as a spectator (can watch the game), but can not make any moves.

## Usage
The contract defines the following messages:
- **CreateGame**:
    Creates a game with a set wager, and randomizes the colour of the creator
- **JoinGame**:
    Join an existing game - if both players have joined, then you can join as a spectator.
- **MakeMove**:
    Make a legal chess move for your own colour. This message also checks game state, and when the game ends, the prize tokens are handed out.
- **Resign**:
    Resign from the game. The other player gets the prize tokens.
- **GetGame**:
    Get information about a single game such as who is playing, chess board state, etc.
- **ListGames**:
    List all chess games (both past, and present).

#### Example use case
1. Player 1 creates a game with a wager of 20 uSCRT. This randomly assigns player one the colour white.
2. Player 2 joins the game that player 1 has created (either via the all games list, or from the game id that player 1 provided). Player 2 has to play as black.
3. Both players are in a game, and make chess moves.
4. Player 3 joins that game as a spectator.
5. After some moves, player 1 wins (checkmate) and gets the prize of 40uSCRT.

#### Additional Use Cases:
1. Players can leave and rejoin matches (for example, if they want to play multiple games at the same).
2. Players can resign from any active game.
3. Games can end with stalemate - this gives the wager amount back to both players.